#!/usr/bin/env bash
# This script changes localhost to resolve to 127.0.0.2 and facebook.com to 8.8.8.8 in /etc/hosts

# Use a temp file because direct sed editing can fail in Docker
tmp_file=$(mktemp)

# Copy current hosts file to tmp_file
cat /etc/hosts > "$tmp_file"

# Replace localhost entry to 127.0.0.2
sed -i '/127\.0\.0\.1\s\+localhost/c\127.0.0.2 localhost' "$tmp_file"

# Check if facebook.com entry exists, else add it
if grep -q 'facebook.com' "$tmp_file"; then
    sed -i '/facebook.com/c\8.8.8.8 facebook.com' "$tmp_file"
else
    echo '8.8.8.8 facebook.com' >> "$tmp_file"
fi

# Move temp file back to /etc/hosts
sudo mv "$tmp_file" /etc/hosts
